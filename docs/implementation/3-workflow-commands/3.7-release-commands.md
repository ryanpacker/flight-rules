# 3.7 Release Commands

Commands for version management and project releases.

## Goals

- Provide intelligent version bump recommendations based on commit analysis
- Support project-specific release workflows stored as documentation
- Work across different project types (npm, Python, Rust, etc.)

## Constraints

- Must detect project type to use appropriate versioning mechanism
- Release workflows are stored as human-readable markdown, not structured config
- Should leverage existing version scripts when present (e.g., npm's "version" lifecycle)

## Dependencies

- **Requires**: None (standalone commands)
- **Enables**: Streamlined release process for any Flight Rules project

---

## 3.7.1. version.bump Command

**Goal**: Analyze changes since the last version tag and recommend/apply a version bump.

**Behavior**:

1. **One-shot mode**: `version.bump {major|minor|patch}` applies the specified bump directly
2. **Conversational mode**: Analyzes commits since last version tag, recommends bump level with reasoning

**Implementation approach**:

1. Find the most recent version tag in git history (e.g., `v0.10.2`, `0.10.2`)
2. Get all commits since that tag using `git log`
3. Analyze commit messages for:
   - Breaking changes â†’ major bump
   - New features â†’ minor bump
   - Bug fixes, docs, refactoring â†’ patch bump
4. Present recommendation with summary of changes
5. Apply version bump using project-appropriate tooling:
   - npm projects: `npm version {major|minor|patch}`
   - Python projects: update `pyproject.toml` or `setup.py`
   - Rust projects: update `Cargo.toml`
   - Other: update detected version files
6. Run any existing version sync scripts (like `scripts/sync-version.js`)

**Acceptance Criteria**:

- [x] Finds the most recent version tag in git history
- [x] Summarizes changes since that tag
- [x] Recommends major/minor/patch with clear reasoning
- [x] Accepts explicit bump level to skip analysis
- [x] Applies version bump using project-appropriate tooling
- [x] Runs existing version lifecycle scripts

**Status**: âœ… Complete

---

## 3.7.2. project.release Command

**Goal**: Execute a project-specific release workflow defined in `docs/release.md`.

**Behavior**:

1. **First run (no `docs/release.md`)**:
   - Interactively determine what "release" means for this project
   - Ask about steps: tests, build, version bump, commit, tag, push, publish
   - Detect project type and suggest common defaults
   - Create `docs/release.md` with the defined process

2. **Subsequent runs**:
   - Read `docs/release.md`
   - Present the steps and ask for confirmation
   - Execute each step in order
   - Report success/failure for each step
   - Stop on failure unless user chooses to continue

**Example `docs/release.md`**:

```markdown
# Release Process

1. Run tests and ensure they pass
2. Run the build
3. Bump the version (use /version.bump)
4. Commit the version bump with message "x.y.z"
5. Push commits and tags to origin
6. Publish to npm with the dev tag
```

**Implementation approach**:

- Parse markdown to extract numbered steps
- Each step is interpreted by the agent (not rigid command parsing)
- Confirm before destructive steps (publish, push)
- Allow skipping individual steps if needed

**Acceptance Criteria**:

- [ ] Creates `docs/release.md` on first run via conversation
- [ ] Detects project type and suggests appropriate defaults
- [ ] Reads and parses steps from existing `docs/release.md`
- [ ] Executes steps in order with progress reporting
- [ ] Confirms before executing destructive steps
- [ ] Handles step failures gracefully

**Status**: ðŸ”µ Planned (not implementing yet)
