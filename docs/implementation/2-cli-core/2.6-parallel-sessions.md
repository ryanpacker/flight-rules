# 2.6 Parallel Sessions

Support for running multiple dev sessions in isolated git worktrees, enabling concurrent AI agent work without file conflicts.

## Goals

- Enable multiple Claude/Cursor agents to work on the same project simultaneously
- Provide isolated worktrees with automatic branch creation
- Track active sessions via a manifest file
- Handle cleanup of orphaned sessions
- Integrate with existing dev-session start/end workflows

## Dependencies

- **Requires**: Git worktree support (standard in modern git)
- **Enhances**: Session Commands (3.3)

---

## 2.6.1. Parallel Create Subcommand

**Goal**: Create a new parallel session in an isolated git worktree

**Approach**:
- Validate prerequisites (git clean, no duplicate session name)
- Create sessions directory as sibling: `../<project>-sessions/`
- Create worktree with `git worktree add` and dedicated branch `session/<name>`
- Register session in `.manifest.json`
- Copy common env files if present
- Display navigation instructions

**Key Features**:
- Auto-detects project name from directory
- Copies `.env`, `.env.local`, `.env.development.local` if they exist
- Creates timestamped session entry in manifest
- Validates not already inside a worktree

**Acceptance Criteria**:
- Worktree created with correct branch name
- Manifest updated with session metadata
- Env files copied when present
- Clear instructions shown for navigating to session

**Status**: ✅ Complete

---

## 2.6.2. Parallel Status Subcommand

**Goal**: Display all active parallel sessions and their state

**Approach**:
- Read `.manifest.json` from sessions directory
- Cross-reference with actual git worktrees (`git worktree list`)
- Display table of active sessions with branch, age, and goals
- Flag any sessions that appear orphaned

**Key Features**:
- Shows session name, branch, start time (relative), and goals
- Indicates main directory status (clean/dirty)
- Detects orphaned sessions (in manifest but worktree missing, or vice versa)

**Acceptance Criteria**:
- Accurate display of all active sessions
- Handles empty/missing manifest gracefully
- Flags mismatches between manifest and actual worktrees

**Status**: ✅ Complete

---

## 2.6.3. Parallel Cleanup Subcommand

**Goal**: Detect and clean up orphaned parallel sessions

**Approach**:
- Compare manifest entries with actual git worktrees
- Identify orphans: manifest entries without worktrees, worktrees without manifest entries
- Offer to remove orphaned entries and worktrees
- Support `--force` flag to skip confirmation

**Key Features**:
- Interactive confirmation for each orphan (unless --force)
- Removes both worktree and manifest entry
- Optionally deletes the session branch
- Handles partially cleaned up states

**Acceptance Criteria**:
- Correctly identifies all orphaned sessions
- Safely removes worktrees and branches
- Updates manifest after cleanup
- Works in non-interactive mode with --force

**Status**: ✅ Complete

---

## 2.6.4. Parallel Remove Subcommand

**Goal**: Remove a specific parallel session with merge workflow options

**Approach**:
- Look up session in manifest by name
- Check for uncommitted changes in the worktree
- Offer merge strategy: PR, direct merge, keep branch, abandon
- Execute chosen strategy
- Clean up worktree and update manifest

**Key Features**:
- Merge conflict detection (checks if base branch has diverged)
- Four merge strategies matching the proposal
- Preserves documentation artifacts before cleanup
- Non-interactive mode uses "keep branch" as safe default

**Acceptance Criteria**:
- All four merge strategies work correctly
- Uncommitted changes detected and handled
- Worktree and manifest cleaned up after removal
- Branch deleted when appropriate (merged strategies)

**Status**: ✅ Complete

---

## 2.6.5. Session Manifest Management

**Goal**: Reliable JSON manifest for tracking parallel sessions

**Approach**:
- Manifest at `../<project>-sessions/.manifest.json`
- Atomic read/write operations
- Schema versioning for future compatibility

**Manifest Schema**:
```json
{
  "version": 1,
  "project": "<project-name>",
  "sessions": [
    {
      "id": "<session-name>",
      "branch": "session/<session-name>",
      "worktree": "../<project>-sessions/<session-name>",
      "startedAt": "<ISO-8601>",
      "goals": ["<goal-description>"],
      "status": "active"
    }
  ]
}
```

**Acceptance Criteria**:
- Manifest created on first session
- Sessions added/removed atomically
- Graceful handling of corrupted/missing manifest
- Version field present for future migrations

**Status**: ✅ Complete

---

## 2.6.6. Dev-Session Workflow Integration

**Goal**: Integrate parallel sessions into existing dev-session start/end prompts

**Approach**:
- Update `dev-session.start.md` to offer parallel option after establishing goals
- Update `dev-session.end.md` to detect parallel session context and offer merge workflow
- Add `parallel.status` as a new workflow command

**Key Features**:
- Agent detects if running inside a worktree
- Session log includes worktree metadata
- End-session flow includes merge strategy selection
- New `/parallel.status` command prompt

**Acceptance Criteria**:
- dev-session.start offers parallel option
- dev-session.end handles merge workflow for parallel sessions
- Agent can detect worktree context
- parallel.status command available

**Status**: ✅ Complete
