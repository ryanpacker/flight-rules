# 2.5 Update Command

Check for newer CLI versions and perform updates, respecting the user's release channel.

## Goals

- Notify users when a newer version is available (passive daily check)
- Provide explicit command to check and perform updates
- Respect release channel (dev vs latest)
- Work correctly in both interactive and non-interactive modes

## Constraints

- User-level config stored in `~/.flight-rules/config.json`
- Passive check runs at most once per day (cached)
- Non-interactive mode: display notification only, no update prompt
- Default channel is `dev` during pre-1.0 development

## Dependencies

- **Requires**: 2.4 Utility Functions (for prompts, file operations)
- **Enables**: None

---

## 2.5.1 User-Level Config

**Goal**: Establish `~/.flight-rules/config.json` for storing user preferences and cache data.

**Approach**:
- Create config file on first use if it doesn't exist
- Structure: `{ channel: "dev" | "latest", lastUpdateCheck: { timestamp, latestVersion } }`
- Utility functions to read/write config

**Acceptance Criteria**:
- Config file created at `~/.flight-rules/config.json`
- Default channel is `dev`
- File is valid JSON and survives read/write cycles

**Status**: ✅ Complete

---

## 2.5.2 Version Check Logic

**Goal**: Check npm registry for latest version on the user's channel.

**Approach**:
- Fetch package metadata from npm registry (`https://registry.npmjs.org/flight-rules`)
- Compare `dist-tags.dev` or `dist-tags.latest` against installed version
- Cache result with timestamp in config file
- Skip check if last check was within 24 hours (unless forced)

**Acceptance Criteria**:
- Correctly fetches latest version for configured channel
- Caches result to avoid repeated network calls
- Respects 24-hour cache window
- Handles network failures gracefully (silent failure, no crash)

**Status**: ✅ Complete

---

## 2.5.3 Passive Update Notification

**Goal**: Display update notification when running any CLI command.

**Approach**:
- Run version check (respecting cache) at start of any command
- If newer version available and TTY mode, display notification after command output
- Message format: "Update available: {current} → {latest}. Run `flight-rules update` to upgrade."
- Suppressed in non-interactive mode
- Can be disabled via `FLIGHT_RULES_NO_UPDATE_CHECK=1`

**Acceptance Criteria**:
- Notification appears when update is available (TTY mode only)
- Does not appear in non-interactive mode
- Does not appear when env var disables it
- Does not slow down commands noticeably (async check or cached)

**Status**: ✅ Complete

---

## 2.5.4 Update Command

**Goal**: Explicit command to check for and perform updates.

**Approach**:
- `flight-rules update` — check and update within current channel
- `flight-rules update --channel=dev|latest` — switch channel and update
- Interactive mode: show current → new version, confirm before updating
- Non-interactive mode: display notification only, do not perform update
- Perform update via `npm install -g flight-rules@{channel}`

**Acceptance Criteria**:
- Shows current and available version
- Asks for confirmation in interactive mode
- Performs update via npm
- `--channel` flag switches and persists channel choice
- Non-interactive mode shows info but doesn't update

**Status**: ✅ Complete
