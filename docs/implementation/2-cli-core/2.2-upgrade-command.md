# 2.2 Upgrade Command

The `flight-rules upgrade` command updates Flight Rules in an existing project.

## Goals

- Replace `.flight-rules/` with new version
- Add new templates to `docs/` without overwriting existing files
- Preserve all user content
- Show version comparison during upgrade

## Constraints

- Never modify existing user files in `docs/`
- Must read current version from manifest.json
- Update manifest.json after upgrade

## Dependencies

- **Requires**: Existing Flight Rules installation
- **Enables**: Access to new commands and templates

---

## 2.2.1. Version Detection

**Goal**: Determine current and target versions

**Approach**:
- Read `manifest.json` for current version
- Fall back to parsing `AGENTS.md` if manifest missing
- Get target version from CLI package.json
- Display comparison to user

**Acceptance Criteria**:
- Shows "Upgrading from vX.X.X to vY.Y.Y"
- Handles missing manifest gracefully
- Creates manifest if not present

**Status**: ✅ Complete

**See also**: [manifest-versioning.md](../manifest-versioning.md) for detailed spec

---

## 2.2.2. Payload Replacement

**Goal**: Replace `.flight-rules/` with new version

**Approach**:
- Remove existing `.flight-rules/` directory
- Copy new payload from npm package
- Write updated manifest.json

**Acceptance Criteria**:
- All old files replaced
- New files include any additions
- Manifest reflects new version and timestamp

**Status**: ✅ Complete

---

## 2.2.3. Template Merging

**Goal**: Add new templates without overwriting user content

**Approach**:
- Compare `doc-templates/` against `docs/`
- For each template: if file doesn't exist in `docs/`, copy it
- Never overwrite existing files

**Acceptance Criteria**:
- New templates added to `docs/`
- Existing user files untouched
- Summary shows what was added

**Status**: ✅ Complete
